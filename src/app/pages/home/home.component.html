<ion-header [translucent]="true">
  <ion-toolbar>
    <!-- <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <img src="assets/icon/reciclar.png" alt="Ekokai" style="height:32px;vertical-align:middle;margin-right:12px;">
      Dashboard Ekokai
    </ion-title> -->
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="home-container">
    <!-- Header de la página -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-icon">
          <ion-icon name="home-outline"></ion-icon>
        </div>
        <div class="header-text">
          <h1>Dashboard Ekokai</h1>
          <p>Visión general del sistema de reciclaje comunitario</p>
        </div>
        <div class="header-stats">
          <div class="stat-item">
            <div class="stat-number">{{ totalKilos | number }}</div>
            <div class="stat-label">KG Total</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ totalUsuarios }}</div>
            <div class="stat-label">Usuarios</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cards de métricas principales -->
    <div class="metrics-grid">
      <ion-card class="metric-card total-kilos-card">
        <ion-card-content>
          <div class="metric-content">
            <div class="metric-icon">
              <ion-icon name="leaf-outline"></ion-icon>
            </div>
            <div class="metric-info">
              <div class="metric-value">{{ totalKilos | number }}</div>
              <div class="metric-label">Kg Reciclados</div>
              <div class="metric-description">Total acumulado en el sistema</div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="metric-card total-users-card">
        <ion-card-content>
          <div class="metric-content">
            <div class="metric-icon">
              <ion-icon name="people-outline"></ion-icon>
            </div>
            <div class="metric-info">
              <div class="metric-value">{{ totalUsuarios }}</div>
              <div class="metric-label">Usuarios Activos</div>
              <div class="metric-description">Participantes en el programa</div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="metric-card best-ecopoint-card">
        <ion-card-content>
          <div class="metric-content">
            <div class="metric-icon">
              <ion-icon name="star-outline"></ion-icon>
            </div>
            <div class="metric-info">
              <div class="metric-value">{{ mejorEcopunto.kilosMes }}</div>
              <div class="metric-label">Mejor Ecopunto</div>
              <div class="metric-description">{{ mejorEcopunto.nombre }}</div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- <ion-card class="metric-card monthly-goal-card">
        <ion-card-content>
          <div class="metric-content">
            <div class="metric-icon">
              <ion-icon name="trophy-outline"></ion-icon>
            </div>
            <div class="metric-info">
              <div class="metric-value">{{ metaPorcentaje }}%</div>
              <div class="metric-label">Meta Mensual</div>
              <div class="metric-description">Progreso del objetivo</div>
            </div>
          </div>
        </ion-card-content>
      </ion-card> -->
    </div>

    <!-- Sección de gráficos -->
    <div class="charts-section">
      <ion-card class="chart-card bar-chart-card">
        <ion-card-header>
          <div class="card-header-content">
            <div class="header-icon">
              <ion-icon name="bar-chart-outline"></ion-icon>
            </div>
            <div class="header-text">
              <ion-card-title>Distribución Mensual</ion-card-title>
              <ion-card-subtitle>Evolución de kilos reciclados por mes</ion-card-subtitle>
            </div>
          </div>
        </ion-card-header>
        
        <ion-card-content>
          <div class="chart-container">
            <canvas baseChart 
              #barChartCanvas
              [data]="barChartData" 
              [options]="barChartOptions" 
              [type]="barChartType" 
              [legend]="barChartLegend">
            </canvas>
            <div class="chart-legend">
              <span class="legend-item">
                <span class="legend-dot green"></span>
                Kilos reciclados
              </span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="chart-card doughnut-chart-card">
        <ion-card-header>
          <div class="card-header-content">
            <div class="header-icon">
              <ion-icon name="pie-chart-outline"></ion-icon>
            </div>
            <div class="header-text">
              <ion-card-title>Meta Mensual</ion-card-title>
              <ion-card-subtitle>Porcentaje de cumplimiento del objetivo</ion-card-subtitle>
            </div>
          </div>
        </ion-card-header>
        
        <ion-card-content>
          <div class="chart-container">
            <div class="chart-overlay">
              <div class="chart-center-value">
                {{ metaPorcentaje }}%
              </div>
            </div>
            <canvas baseChart 
              #doughnutChartCanvas
              [data]="doughnutChartData" 
              [options]="doughnutChartOptions" 
              [type]="doughnutChartType">
            </canvas>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Sección de usuarios recientes -->
    <!-- <ion-card class="users-section-card">
      <ion-card-header>
        <div class="card-header-content">
          <div class="header-icon">
            <ion-icon name="people-circle-outline"></ion-icon>
          </div>
          <div class="header-text">
            <ion-card-title>Usuarios Recientes</ion-card-title>
            <ion-card-subtitle>{{ usuariosRecientesFiltrados.length }} usuarios encontrados</ion-card-subtitle>
          </div>
        </div>
      </ion-card-header>

      <ion-card-content>
        <div class="filters-section">
          <div class="filters-grid">
            <div class="filter-item search-filter">
              <ion-label position="stacked">
                <ion-icon name="search-outline"></ion-icon>
                Buscar Usuario
              </ion-label>
              <ion-input 
                [(ngModel)]="filtroUsuario"
                (ionInput)="onFiltroUsuarioChange()"
                placeholder="Nombre o email"
                class="search-input">
              </ion-input>
            </div>

            <div class="filter-item month-filter">
              <ion-label position="stacked">
                <ion-icon name="calendar-outline"></ion-icon>
                Filtrar por Mes
              </ion-label>
              <ion-select 
                [(ngModel)]="filtroMes"
                (ionChange)="onFiltroMesChange()"
                placeholder="Seleccionar mes"
                class="month-select">
                <ion-select-option value="">Todos los meses</ion-select-option>
                <ion-select-option *ngFor="let mes of meses" [value]="mes.value">{{ mes.label }}</ion-select-option>
              </ion-select>
            </div>

            <div class="filter-item clear-filter">
              <ion-button 
                fill="clear" 
                (click)="limpiarFiltros()"
                class="clear-filters-btn">
                <ion-icon name="refresh-outline"></ion-icon>
                Limpiar Filtros
              </ion-button>
            </div>
          </div>
        </div>

        <div class="users-list">
          <ion-item *ngFor="let user of usuariosRecientesFiltrados; let i = index" 
                    class="user-item" 
                    [class.zebra]="i % 2 === 1">
            <div class="user-avatar" slot="start">
              <div class="avatar-initials" [ngClass]="'avatar-' + (user.rol ? user.rol.toLowerCase() : 'default')">
                {{ (user.nombre ? user.nombre[0] : '') + (user.apellido ? user.apellido[0] : '') }}
              </div>
            </div>
            
            <ion-label class="user-info">
              <h3 class="user-name">{{ user.nombre }} {{ user.apellido }}</h3>
              <div class="user-details">
                <ion-badge [ngClass]="'role-badge-' + (user.rol ? user.rol.toLowerCase() : 'default')" class="role-badge">
                  <ion-icon name="person-circle-outline"></ion-icon>
                  {{ user.rol | titlecase }}
                </ion-badge>
                <span class="user-date">
                  <ion-icon name="calendar-outline"></ion-icon>
                  {{ user.createdAt | date:'dd/MM/yyyy HH:mm' }}
                </span>
              </div>
            </ion-label>
            
            <div class="user-actions" slot="end">
              <ion-button fill="clear" 
                         (click)="verUsuario(user)" 
                         title="Ver usuario"
                         class="action-btn view-btn">
                <ion-icon name="eye-outline"></ion-icon>
              </ion-button>
              <ion-button fill="clear" 
                         (click)="editarUsuario(user)" 
                         title="Editar usuario"
                         class="action-btn edit-btn">
                <ion-icon name="create-outline"></ion-icon>
              </ion-button>
            </div>
          </ion-item>

          <div *ngIf="usuariosRecientesFiltrados.length === 0" class="empty-state">
            <div class="empty-content">
              <div class="empty-icon">
                <ion-icon name="people-outline"></ion-icon>
              </div>
              <h3>No hay usuarios</h3>
              <p>No se encontraron usuarios que coincidan con los filtros aplicados</p>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card> -->
  </div>
</ion-content>