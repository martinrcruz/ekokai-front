<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Xiaomi S400 BLE Scan</title>
</head>
<body>
  <h1>Escaneo Xiaomi S400</h1>
  <button id="scanBtn">Escanear báscula</button>
  <pre id="output">Sin escanear.</pre>

  <script>
    const btn = document.getElementById('scanBtn');
    const output = document.getElementById('output');
    const S400_SERVICE = '0000fe95-0000-1000-8000-00805f9b34fb';

    btn.addEventListener('click', async () => {
      output.textContent = 'Solicitando permiso de escaneo...';
      try {
        const scan = await navigator.bluetooth.requestLEScan({
          acceptAllAdvertisements: true,
          keepRepeatedDevices: true
        });

        output.textContent = '🔍 Escaneando... pisa la báscula S400';
        navigator.bluetooth.addEventListener('advertisementreceived', event => {
          const data = event.serviceData.get(S400_SERVICE);
          if (!data) return;
          const hex = [...new Uint8Array(data.buffer)]
                        .map(b=>b.toString(16).padStart(2,'0')).join('');
          output.textContent = `RAW: ${hex}`;
          // Aquí puedes llamar a parseS400Payload(hex)
        });

        setTimeout(() => {
          scan.stop();
          output.textContent += '\n🔵 Escaneo detenido tras 30 s.';
        }, 30000);

      } catch (err) {
        output.textContent = `Error: ${err}`;
      }
    });
  </script>
</body>
</html>
